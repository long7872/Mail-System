ğŸ§­ Step 4. Workflow (Signup â†’ Send â†’ Receive)
ğŸ§© Signup

User creates an account.

Server generates:

RSA key pair (public/private)

Optional self-signed certificate (X.509)

Store in:

users â†’ username, email, hashed password

user_keys â†’ public/private key

ğŸ§© Login

User authenticates with username + password.

Server verifies hash.

Decrypts private key (if needed) for signing.

ğŸ§© Send Email

Sender composes message.

Server:

Signs message using senderâ€™s private key

Encrypts message using recipientâ€™s public key

Stores message in emails table (encrypted content + signature + is_encrypted=true)

ğŸ§© Receive Email

Receiver downloads message.

Server provides:

Encrypted message + signature

Client:

Decrypts using receiverâ€™s private key

Verifies signature with senderâ€™s public key

ğŸ” Step 5. Example key workflow (summary)
Action	Uses Key	From
Sign message	Senderâ€™s private key	user_keys.private_key_encrypted
Verify message	Senderâ€™s public key	user_keys.public_key
Encrypt message	Receiverâ€™s public key	user_keys.public_key
Decrypt message	Receiverâ€™s private key	user_keys.private_key_encrypted